<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../main.css">
    <link rel="stylesheet" href="../assets/boostrap/bootstrap.css">
    <link rel="stylesheet" href="../assets/swiper/swiper.css">
    <link rel="stylesheet" href="../assets/datatable/datatables.css">
    <script src="../cookie.js"></script>


    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>


    <script>
        readSession("proccess.html");
    </script>

    <div class="header">
        <div class="container">
            <div class="header-data-container flex j-space-between">
                <div class="header-item  flex j-center a-center" style="margin-left: 20px;">
                    <div class="header-item-logo ">
                        <img src="../assets/img/headerLogo.png" alt="" srcset="">
                    </div>
                    <div class="header-item-text">
                        <span class="header-title-text">T.C Sağlık Bakanlığı
                            Aile Hekimiği Sistemi
                        </span>
                        <span class="header-title-text"></span>
                    </div>
                </div>
                <div class="header-item flex a-center">
                    <div class="btn-group">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-user-tie"></i></i><span id="loginNameSurname"
                                style="margin-left: 10px;"></span>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="index.html"><i class="fas fa-sign-out-alt"></i><span>Çıkış
                                    Yap</span></a>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-body">
        <div class="container" style="height: 1000px;  padding: 30px;  background-color:rgba(127, 130, 137,0.3);">
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-2">
                    TC :
                </div>
                <div class="col-md-2" id="hastaTC"></div>
            </div>
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-2">
                    Hasta Adı :
                </div>
                <div class="col-md-2" id="hastaName"></div>
            </div>
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-2">
                    Hasta Soyadı :
                </div>
                <div class="col-md-2" id="hastaSurname"></div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    Yaşı :
                </div>
                <div class="col-md-2" id="hastaAge"></div>
            </div>
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-2">
                    Kan Grubu :
                </div>
                <div class="col-md-2" id="bloodType"></div>
            </div>
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-2">
                    İşlem Tipi :
                </div>
                <div class="col-md-4">
                    <select name="proccesType" style="width: 100%;" id="proccesType">
                        <option value="KanAlma">Kan Alma</option>
                        <option value="GenelMuayene">Genel Muayene</option>
                        <option value="Recete">Reçete</option>
                        <option value="Recete">Aşı</option>
                        <option value="Recete">Sağlık Raporu</option>
                    </select>
                </div>
            </div>
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-2">
                    Detay:
                </div>
                <div class="col-md-4">
                    <textarea class="form-control" rows="5" id="description" name="detay"></textarea>
                </div>
            </div>
            <div class="row" style="margin-top: 10px;">
                <div class="col-md-6" style="display: flex; justify-content: flex-end;">
                    <button type="button" class="btn btn-success" onclick="finalProccess()">İşlemi Tamamla</button>
                </div>

            </div>

        </div>

    </div>
    <div class="footer">
        <div class="footer-contact flex">
            <div class="footer-contact-container">
                <div class="footer-contact-container-title">İLETİŞİM</div>
                <div class="footer-contact-container-content"> Adres : Yenişehir Mh. Alpha Beta Gamma Sk. NO : V/IXX
                    Mars/Silivri</div>
            </div>
            <div class="footer-contact-container">
                <div class="footer-contact-container-title">Hasan Korkmaz</div>
                <div class="footer-contact-container-icons flex j-center">
                    <i class="fab fa-github"></i>
                    <i class="fab fa-linkedin"></i>
                    <i class="fab fa-facebook-f"></i>
                    <i class="fab fa-instagram"></i>
                </div>
            </div>
            <div class="footer-contact-container">
                <div class="footer-contact-container-title">Yusuf Şirin</div>
                <div class="footer-contact-container-icons flex j-center">
                    <i class="fab fa-github"></i>
                    <i class="fab fa-linkedin"></i>
                    <i class="fab fa-facebook-f"></i>
                    <i class="fab fa-instagram"></i>
                </div>
            </div>

        </div>
        <div class="copyright">© Copyright 2020 | Hasan & Yusuf Organization Tüm Hakları MIT Lisansı ile dağıtıma
            açıktır.</div>
    </div>
    <script src="../assets/boostrap/bootstrap.js"></script>
    <script src="../assets/notify/notify.js"></script>
    <script src="../assets/js/util.js"></script>
    <script>
        document.getElementById('loginNameSurname').innerHTML = getCookie('AHSnameSurname');
        var hastatc = location.href.split("hastatc=")[1];
        console.log(hastatc);
        $.ajax({
            type: "POST",
            url: "../server/patient.php",
            data: { "FunctionName": "Get", "Parameters": [hastatc] },
            success: function (response) {
                var obj = JSON.parse(response);
                if (obj.Status == true) {
                    var hastaDetail = obj.Data;
                    $('#hastaTC').text(hastaDetail.TC);
                    $('#hastaName').text(hastaDetail.Ad);
                    $('#hastaSurname').text(hastaDetail.Soyad);
                    $('#hastaAge').text(hastaDetail.Yas);
                    $('#bloodType').text(hastaDetail.KanGrubu);
                }

            }
        });
        function finalProccess() {
            var procces = $('#proccesType').val();
            var detail = $('#description').val();

            $.ajax({
                type: "POST",
                url: "../server/proccess.php",
                data: { "FunctionName": "add", "Parameters": [hastatc, getCookie("AHSTC"), procces, detail] },
                success: function (response) {
                    console.log(response);
                    var obj = JSON.parse(response);
                    if (obj.Status == true) {
                        $.ajax({
                            type: "POST",
                            url: "../server/siramatik.php",
                            data: { "FunctionName": "Update", "Parameters": [hastatc, DateFormatYYYYMMDD(new Date())] },
                            success: function (response2) {
                                $.notify(obj.Message, "success");
                            }
                        });
                        setTimeout(() => {
                            window.location.href = "proccess.html?hastatc=" + hastatc;

                        }, 2500);
                    }

                }
            });

        }
    </script>



</body>

</html>